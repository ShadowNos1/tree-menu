# Демонстрация древовидного меню (tree_menu)

Это простая Django-приложение, реализующее древовидное меню, хранящееся в базе данных и выводимое с помощью `template tag`.

Основные возможности:
- Меню хранится в БД (модели `Menu` и `MenuItem`).
- Меню можно редактировать через стандартную админку Django.
- Рендеринг меню осуществляется с помощью тегa шаблона: `{% draw_menu 'main_menu' %}`.
- Активный пункт определяется по `request.path` (выбирается самое длинное совпадение-префикс).
- Все предки активного элемента автоматически разворачиваются (`expanded`).
- Непосредственные дети активного пункта тоже разворачиваются.
- Поддерживается несколько меню на одной странице — они идентифицируются по уникальному полю `name` в модели `Menu`.
- Пункт меню может указывать URL как явно (`url`), так и через `named_url` (имя маршрута Django), который разрешается через `reverse()`.
- На отрисовку меню выполняется ровно один запрос к БД.

Установка и запуск (Windows / PowerShell):
1. Склонируйте репозиторий и перейдите в папку проекта
```powershell
cd "C:\Users\andre\OneDrive\Рабочий стол\tree-menu"
```
2. Создайте и активируйте виртуальное окружение
```powershell
python -m venv venv
.\venv\Scripts\Activate.ps1
```
3. Установите зависимости
```powershell
pip install -r requirements.txt
```
4. Создайте и примените миграции
```powershell
python manage.py makemigrations
python manage.py migrate
```
5. Создайте суперпользователя (для доступа в админку)
```powershell
python manage.py createsuperuser
```
6. (Опционально) Создайте демо-меню для локальной проверки
```powershell
python manage.py create_demo_menu
```
7. Запустите дев-сервер
```powershell
python manage.py runserver
```
Откройте в браузере: http://127.0.0.1:8000/ — демо-страница, и http://127.0.0.1:8000/admin/ — админка.

Использование в шаблоне:
```django
{% load draw_menu %}
{% draw_menu 'main_menu' %}
```
`'main_menu'` — это значение поля `name` модели `Menu`.

Объяснение поведения:
- Активный пункт определяется по совпадению URL пункта меню с текущим `request.path`. Если несколько пунктов подходят, выбирается самое длинное совпадение (longest-prefix match).
- Все предки активного пункта будут помечены как `expanded`, а прямые дети активного пункта также получат `expanded`.
- Для `named_url` используется `reverse()`; если reverse не проходит — URL считается пустым.

Редактирование меню:
- Через админку (`/admin/`) вы можете создать `Menu` и добавить `MenuItem` через inline.
- `MenuItem` поддерживает `parent` (self-FK) — это и позволяет строить дерево.

Тесты и отладка:
- Запуск тестов
```powershell
python manage.py test --verbosity 2
```
- Есть тест, который проверяет, что при рендеринге меню используется ровно один запрос к базе, и тест, проверяющий корректное определение активного пункта.

Публикация на GitHub:
```powershell
git init
git add .
git commit -m "Добавлено приложение tree_menu"
git branch -M main
git remote add origin https://github.com/<yourname>/tree-menu.git
git push -u origin main
```

Лицензия: MIT

Если хотите — я могу помочь подготовить пакет для публикации (setup/pyproject) или добавить i18n-поддержку (`gettext`) для админки и шаблонов.
# Tree Menu Demo
See README for usage.
